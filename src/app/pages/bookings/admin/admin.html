<div class="flex flex-col gap-3">
    <div class="flex justify-between items-center">
        <div>
            <h1 class="text-3xl font-semibold">Bookings</h1>
            <p>View and manage all Bookings</p>
        </div>
    </div>
    <p-table [size]="'large'" [stripedRows]="true" [paginator]="true" [rows]="10" [rowsPerPageOptions]="[10, 25, 50]"
        [lazy]="true" (onLazyLoad)="loadBookings($event)"
        [totalRecords]="this.slotBookingService.slotBookings().data?.totalDocs || 0"
        [value]="this.slotBookingService.slotBookings().data?.data || []" [tableStyle]="{ 'min-width': '50rem' }">
        <ng-template #header>
            <tr>
                <th class="w-[80px]">
                    S.No.
                </th>
                <th>
                    Name
                </th>
                <th>
                    Mobile
                </th>
                <th>
                    Message
                </th>
                <th>
                    Attended By
                </th>
                <th>
                    Requested At
                </th>
                <th>
                    Actions
                </th>
            </tr>
        </ng-template>
        @if (this.slotBookingService.slotBookings().isLoading) {
        <ng-template #body let-rowData>
            <tr>
                <td><p-skeleton height="1.5rem" /></td>
                <td><p-skeleton height="1.5rem" /></td>
                <td><p-skeleton height="1.5rem" /></td>
                <td><p-skeleton height="1.5rem" /></td>
                <td><p-skeleton height="1.5rem" /></td>
                <td><p-skeleton height="1.5rem" /></td>
                <td><p-skeleton height="1.5rem" /></td>
            </tr>
        </ng-template>
        }
        @else {
        <ng-template #body let-rowData>
            <tr>
                <td>
                    {{ rowData.index }}
                </td>
                <td>
                    {{ rowData.name }}
                </td>
                <td>
                    {{ rowData.mobile }}
                </td>
                <td>
                    {{ rowData.message }}
                </td>
                <td>
                    {{ rowData.attendedBy?.name || "Not Attended" }}
                </td>
                <td>
                    {{ rowData.createdAt }}
                </td>
                <td>
                    <div class="flex gap-2">
                        @if (!rowData.attendedBy) {
                        <p-button [label]="'Mark as attended'" icon="pi pi-check" size="small" [severity]="'success'"
                            [outlined]="true" [disabled]="slotBookingService.markAttendanceSlotBookingMeta().isLoading"
                            (onClick)="confirmMarkAsAttended($event, rowData._id)" />
                        <p-confirmpopup />
                        } @else {
                        <div class="flex flex-col gap-2">
                            <p-button disabled label="Already attended" icon="pi pi-check" size="small"
                                [severity]="'success'" [outlined]="true" />
                            <span class="text-sm">{{ rowData.attendedAt }} by {{ rowData.attendedBy?.name }}</span>
                        </div>
                        }
                    </div>
                </td>
            </tr>
        </ng-template>
        }
        <ng-template #emptymessage>
            <tr>
                <td colspan="6" class="text-center">
                    <div class="w-full grid content-center">
                        <p class="text-lg font-semibold">No Bookings Found</p>
                    </div>
                </td>
            </tr>
        </ng-template>
    </p-table>
</div>